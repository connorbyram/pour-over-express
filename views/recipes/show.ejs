<%- include('../partials/header') %>

<div class="main">
    <section>
        <div class="container">
            <div class="main-div">
                <h1>Recipe Deets</h1>
            </div>
        </div>
        <div class="container">
            <div class="main-div">
                <div id="user-header">
                    <img alt="avatar" id="avatar" src="<%= recipe.user.avatar %>" referrerpolicy="no-referrer">
                    <div id="user-info">
                        <div id="user-name"><%= recipe.user.name %></div>
                        <text id="date"><%= recipe.createdAt.toLocaleDateString() %></text>
                    </div>
                </div>
                <h2><%= recipe.title %></h2>
                <div class="recipe-data-item">
                    <strong>Roaster:</strong> <%= recipe.roaster %>
                </div>
                <div class="recipe-data-item">
                    <strong>Varietal:</strong> <%= recipe.beanVarietal %>
                </div>
                <div class="recipe-data-item">
                    <strong>Process:</strong> <%= recipe.processMethod %>
                </div>
                <div class="recipe-data-item">
                    <strong>Roast Level:</strong> <%= recipe.roastLevel %>
                </div>
                <div class="recipe-data-item">
                    <strong>Grind:</strong> <%= recipe.grindSize %>
                </div>
                <div class="recipe-data-item">
                    <strong>Coffee (g):</strong> <%= recipe.gramsCoffee %>
                </div>
                <div class="recipe-data-item">
                    <strong>Water (g):</strong> <%= recipe.gramsWater %>
                </div>
                <div class="recipe-data-item">
                    <strong>Temp:</strong> <%= recipe.waterTemp %><%=recipe.tempUnit%>
                </div>
                <div class="recipe-data-item">
                    <strong>Notes:</strong> <%= recipe.notes %>
                </div>
                <div class="button-grid">
                    <% if (user.googleId === recipe.user.googleId) { %>
                        <a class="button-main" href="/recipes/<%= recipe._id %>/edit">TWEAK<img src="/assets/images/arrow-white.svg" class="arrow"></a>
                        <form class="delete-form" action="/recipes/<%= recipe._id %>?_method=DELETE" method="POST">
                            <button class="button-secondary" type="submit">DELETE<img src="/assets/images/arrow-white.svg" class="arrow"></button>
                        </form>
                    <% } %>
                </div>
            </div>
        </div>
    </section>
    <section>
        <div class="container">
            <div class="main-div">
                <div id="create-review">
                    <h3>Leave a Note:</h3>
                    <form id="add-review-form" action="/recipes/<%= recipe._id %>/reviews" method="POST">
                        <select class="dropdown" name="rating">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5" selected>5</option>
                        </select>
                        <textarea name="comment" id="comment-box" rows="5" placeholder="Be constructive..."></textarea>
                        <button class="button-main" type="submit">SUBMIT<img src="/assets/images/arrow-white.svg" class="arrow"></button>
                    </form>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="main-div">
                <h3>Notes</h3>
                5 out of 5 
                <div id="reviews">
                    <% if (recipe.reviews.length) { %>
                        <% let total = 0 %>
                        <% recipe.reviews.forEach(function(review) { %>
                            <div id="user-header">
                                <img alt="avatar" id="avatar" src="<%= review.user.avatar %>" referrerpolicy="no-referrer">
                                <div id="user-info">
                                    <div id="user-name"><%= review.user.name %></div>
                                    <%= review.rating %> out of 5
                                    <text id="date"><%= review.createdAt.toLocaleDateString() %></text>
                                </div>
                            </div>
                            <div class="comment"><%= review.comment %></div>
                            <% if (user.googleId === review.user.googleId) { %>
                                <!-- <a class="button-main" href="/recipes/<%= recipe._id %>/edit">TWEAK<img src="/assets/images/arrow-white.svg" class="arrow"></a> -->
                                <form class="delete-form" action="/recipes/<%= recipe._id %>?_method=DELETE" method="POST">
                                    <button class="button-secondary" type="submit">DELETE<img src="/assets/images/arrow-white.svg" class="arrow"></button>
                                </form>
                            <% } %>
                        <% }); %>
                    <% } else { %>
                        No Reviews Yet
                    <% } %>
                </div>
            </div>
        </div>
    </section>
</div>


<%- include('../partials/footer') %>